# What is A/B testing
In A/B testing, we randomly assign users to two (or more) groups and measure metrics (KPI) in each of them. The fact is when we see that one group is performing better, we can't know whether the effect is real or just by chance. That is when statistics come into play.

There are two major statistical framework that can be used to perform this task: the traditional null-hypothesis **Frequentist**  and  **Bayesian** framework. 

# Differences and why Bayesian

The **frequentist** framework typically assume that there are two hypotheses: one assumes there is no difference (null hypothesis) and the other assumes there is (alternative hypothesis). The **goal** is to disprove the null with a certain level of certainty (the significance level). On the contrary, if we failed to prove that, it doesn't necessarily mean that we can accept the null hypothesis.

The **Bayesian** framework has a completely different way of approaching the problem. It begins with a **prior** (in which we assume the metrics can be any value and with equal chance). This means that each scenario initially has an equal probability of 50%  to be better than the other. As we collect more and more **data**, we update our knowledge and eventually we can conclude with the **posterior** something like "Given the data I have observed, I can conclude that there is a xx% chance that version B is better"

Why using Bayesian ? It is due to the fact that Bayesian framework include the uncertainty, it is more interpretable when it can answer exactly what the end user concern: What are the chances that we are wrong and what is the risk in that case. In essence, the two methods is not so different in terms of numerical expression. But when it comes to interpretability, Bayes  is a clear winner. Moreover, the Bayes approach is more robust to the peaking problem, so that we don't have to determine the power and sample prior to the experimentation as we do in frequentist approach.
# The Bayesian A/B test model

There are two main concepts in the model

 - The prior distribution: what we know about the metrics before the test
 - The posterior distribution: is constructed by updating the prior with data
 
 The prior and posterior must be conjugate distributions (belong to the same probability distribution family)

## Binary metrics
With binary metrics like conversions or clicks, we use the Beta-Binomial model
In the model, we assume that the conversion rate <a href="https://www.codecogs.com/eqnedit.php?latex=P_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?P_{A}" title="P_{A}" /></a> has a Beta distribution with parameters <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a> and <a href="https://www.codecogs.com/eqnedit.php?latex=\beta" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\beta" title="\beta" /></a>. To avoid complicated issue, we use the uninformative prior, we assign  <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a> and <a href="https://www.codecogs.com/eqnedit.php?latex=\beta" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\beta" title="\beta" /></a> as 1
We denote the count of converted users with <a href="https://www.codecogs.com/eqnedit.php?latex=X_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X_{A}" title="X_{A}" /></a> and the count of all users with <a href="https://www.codecogs.com/eqnedit.php?latex=n_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?n_{A}" title="n_{A}" /></a>, and we model
 <a href="https://www.codecogs.com/eqnedit.php?latex=X_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X_{A}" title="X_{A}" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=P_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?P_{A}" title="P_{A}" /></a> ~ Bin(<a href="https://www.codecogs.com/eqnedit.php?latex=n_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?n_{A}" title="n_{A}" /></a>, <a href="https://www.codecogs.com/eqnedit.php?latex=P_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?P_{A}" title="P_{A}" /></a>). Since 
 <a href="https://www.codecogs.com/eqnedit.php?latex=p_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?p_{A}" title="p_{A}" /></a> ~ Beta(<a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a>, <a href="https://www.codecogs.com/eqnedit.php?latex=\beta" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\beta" title="\beta" /></a>)
, by using Bayes's theorem we get:
<a href="https://www.codecogs.com/eqnedit.php?latex=P_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?P_{A}" title="P_{A}" /></a> | <a href="https://www.codecogs.com/eqnedit.php?latex=X_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X_{A}" title="X_{A}" /></a> ~ Beta(<a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a> + <a href="https://www.codecogs.com/eqnedit.php?latex=x_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?x_{A}" title="x_{A}" /></a> ,  <a href="https://www.codecogs.com/eqnedit.php?latex=\beta" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\beta" title="\beta" /></a> + <a href="https://www.codecogs.com/eqnedit.php?latex=n_{A}&space;-&space;x_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?n_{A}&space;-&space;x_{A}" title="n_{A} - x_{A}" /></a>)
It means that we update the prior by adding the number of successes to <a href="https://www.codecogs.com/eqnedit.php?latex=\alpha" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\alpha" title="\alpha" /></a> and the number of failures to <a href="https://www.codecogs.com/eqnedit.php?latex=\beta" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\beta" title="\beta" /></a>

## Continuous metrics
With continuous metrics (duration, revenue per user), we use the Normal-Normal model. For example, we can estimate the revenue per user. Assuming that the expected revenue per user <a href="https://www.codecogs.com/eqnedit.php?latex=\mu_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\mu_{A}" title="\mu_{A}" /></a> has a Normal distribution with parameters <a href="https://www.codecogs.com/eqnedit.php?latex=\mu_{0}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\mu_{0}" title="\mu_{0}" /></a> and <a href="https://www.codecogs.com/eqnedit.php?latex=\frac{\sigma^2_{0}}{n_{0}}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\frac{\sigma^2_{0}}{n_{0}}" title="\frac{\sigma^2_{0}}{n_{0}}" /></a>. For simplicity, we denote the sample average with <a href="https://www.codecogs.com/eqnedit.php?latex=X_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X_{A}" title="X_{A}" /></a> and the sample standard deviation with <a href="https://www.codecogs.com/eqnedit.php?latex=s_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?s_{A}" title="s_{A}" /></a>, and we assume that <a href="https://www.codecogs.com/eqnedit.php?latex=X_{A}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?X_{A}" title="X_{A}" /></a> is approximately normally distributed as well. The update rule is as following:

<a href="https://www.codecogs.com/eqnedit.php?latex=\mu_{A}&space;|&space;X_{A}&space;\sim&space;N((\frac{n_{A}}{s^2_{A}}&space;&plus;&space;\frac{n_{0}}{\sigma^2_{0}})^{-1}&space;(\frac{n_{A}}{s^2_{A}}&space;.\bar{X}_{A}&space;&plus;&space;\frac{n_{0}}{\sigma^2_{0}}.\mu_{0}),&space;(\frac{n_{A}}{s^2_{A}}&space;&plus;&space;\frac{n_{0}}{\sigma^2_{0}})^{-1})" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\mu_{A}&space;|&space;X_{A}&space;\sim&space;N((\frac{n_{A}}{s^2_{A}}&space;&plus;&space;\frac{n_{0}}{\sigma^2_{0}})^{-1}&space;(\frac{n_{A}}{s^2_{A}}&space;.\bar{X}_{A}&space;&plus;&space;\frac{n_{0}}{\sigma^2_{0}}.\mu_{0}),&space;(\frac{n_{A}}{s^2_{A}}&space;&plus;&space;\frac{n_{0}}{\sigma^2_{0}})^{-1})" title="\mu_{A} | X_{A} \sim N((\frac{n_{A}}{s^2_{A}} + \frac{n_{0}}{\sigma^2_{0}})^{-1} (\frac{n_{A}}{s^2_{A}} .\bar{X}_{A} + \frac{n_{0}}{\sigma^2_{0}}.\mu_{0}), (\frac{n_{A}}{s^2_{A}} + \frac{n_{0}}{\sigma^2_{0}})^{-1})" /></a>

# Reference
https://towardsdatascience.com/how-to-do-bayesian-a-b-testing-fast-41ee00d55be8
http://varianceexplained.org/r/bayesian-ab-testing/
https://www.evanmiller.org/how-not-to-run-an-ab-test.html
